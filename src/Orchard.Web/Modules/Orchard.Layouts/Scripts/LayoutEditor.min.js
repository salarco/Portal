angular.module("LayoutEditor",["ngSanitize","ngResource","ui.sortable"]);angular.module("LayoutEditor").factory("scopeConfigurator",function(){return{configureForElement:function(n,t){t.find(".layout-panel").click(function(n){n.stopPropagation()});var i=t.find(".layout-element").first();i.hasClass("layout-element")||(i=t.parent());console.log("Configuring keypress handler on "+n.element.type+".");console.log(i);i.keypress(function(t){console.log("Keypress detected on "+n.element.type+".");n.keypress(t);t.stopPropagation()});n.click=function(n,i){console.log("Setting focus to "+n.type+".");n.setIsFocused();var r=$(i.target);r.hasClass("layout-element")||(r=t.find(".layout-element").first());r.focus();i.stopPropagation()};n.keypress=function(t){var i=String.fromCharCode(t.which);console.log("Keypress "+i+" handled on element "+n.element.type+".");n.$apply(function(){i=="c"?n.element.copyToClipboard():i=="v"&&n.element.pasteFromClipboard()})}},configureForContainer:function(n){n.invokeAddContentElement=function(t){n.$root.addElement(t.id).then(function(t){n.$apply(function(){var r=n.element,i=LayoutEditor.Content.from({contentType:t.element.typeName,contentTypeLabel:t.element.typeLabel,contentTypeClass:t.element.typeClass,data:decodeURIComponent(t.element.data),html:decodeURIComponent(t.element.html.replace(/\+/g,"%20"))});r.addChild(i);i.setIsFocused()})})};n.sortableOptions={cursor:"move",delay:150,distance:5,start:function(t,i){n.$apply(function(){n.element.canvas.isDragging=!0;n.element.isDropTarget=!0});i.placeholder.height(i.item.height())},stop:function(){n.$apply(function(){n.element.canvas.isDragging=!1;n.element.isDropTarget=!1})}};n.getClasses=function(n){var t=["layout-element"];return!n.children||t.push("layout-container"),t.push("layout-"+n.type.toLowerCase()),n.type=="Row"&&t.push("row"),n.type=="Column"&&(t.push("col-xs-"+n.width),t.push("col-xs-offset-"+n.offset)),n.type=="Content"&&t.push("layout-content-"+n.contentTypeClass),n.getIsActive()&&t.push("layout-element-active"),n.getIsFocused()&&t.push("layout-element-focused"),n.getIsSelected()&&t.push("layout-element-selected"),n.isDropTarget&&t.push("layout-element-droptarget"),t};n.keypress=function(t){var i=String.fromCharCode(t.which);console.log("Keypress "+i+" handled on container "+n.element.type+".");n.$apply(function(){i=="c"?n.element.copyToClipboard():i=="v"&&n.element.pasteChildFromClipboard()})}}}});angular.module("LayoutEditor").directive("orcLayoutCanvas",function(n,scopeConfigurator,t){return{restrict:"E",scope:{},controller:function($scope,$element,$attrs){$scope.element=$attrs.model?eval($attrs.model):new LayoutEditor.Canvas(null,null,null,null,null,[]);scopeConfigurator.configureForElement($scope,$element);scopeConfigurator.configureForContainer($scope,$element);$scope.sortableOptions.axis="y";$scope.$root.layoutDesignerHost=$element.closest(".layout-designer").data("layout-designer-host");$scope.$root.editElement=function(n,t){var i=$scope.$root.layoutDesignerHost;return i.editElement(n,t)};$scope.$root.addElement=function(n,t){var i=$scope.$root.layoutDesignerHost;return i.addElement(n,t)};$scope.activateInlineEditing=function(){$scope.element.inlineEditingIsActive=!0;var n=$("#layout-canvas-"+$scope.$id+" .layout-content-markup").first().attr("id");tinymce.init({selector:"#layout-canvas-"+$scope.$id+" .layout-content-markup",theme:"modern",schema:"html5",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern","fullscreen autoresize"],toolbar:"undo redo cut copy paste | bold italic | bullist numlist outdent indent formatselect | alignleft aligncenter alignright alignjustify ltr rtl | link unlink charmap | code fullscreen close",setup:function(n){n.addButton("close",{text:"Close",tooltip:"Deactivate inline editing",icon:!1,onclick:function(){tinymce.remove("#layout-canvas-"+$scope.$id+" .layout-content-markup");$scope.element.inlineEditingIsActive=!1}})},convert_urls:!1,valid_elements:"*[*]",extended_valid_elements:"script[type|defer|src|language]",statusbar:!1,skin:"orchardlightgray",inline:!0,fixed_toolbar_container:"#layout-canvas-"+$scope.$id+" > .layout-toolbar-container",init_instance_callback:function(t){t.id==n&&tinymce.execCommand("mceFocus",!1,t.id)}})}},templateUrl:t.baseUrl+"Templates/orc-layout-canvas.html",replace:!0,link:function(n,t){t.find(".layout-toolbar-container").click(function(n){n.stopPropagation()});$(window).click(function(){n.$apply(function(){n.element.canvas.activeElement=null;n.element.canvas.focusedElement=null})})}}});angular.module("LayoutEditor").directive("orcLayoutChild",function(n){return{restrict:"E",scope:{element:"="},link:function(t,i){var r="<orc-layout-"+t.element.type.toLowerCase()+" element='element' />",u=n(r)(t);$(i).replaceWith(u)}}});angular.module("LayoutEditor").directive("orcLayoutColumn",function(n,t,i){return{restrict:"E",scope:{element:"="},controller:function(n,i){t.configureForElement(n,i);t.configureForContainer(n,i);n.sortableOptions.axis="y"},templateUrl:i.baseUrl+"Templates/orc-layout-column.html",replace:!0}});angular.module("LayoutEditor").directive("orcLayoutContent",function(n,t){return{restrict:"E",scope:{element:"="},controller:function(t,i){n.configureForElement(t,i);t.edit=function(){t.$root.editElement(t.element.contentType,t.element.data).then(function(n){t.element.data=decodeURIComponent(n.element.data);t.element.html=decodeURIComponent(n.element.html.replace(/\+/g,"%20"));t.$apply()})};t.updateContent=function(n){t.element.html=n.target.innerHTML}},templateUrl:t.baseUrl+"Templates/orc-layout-content.html",replace:!0,link:function(n,t){t.find(".layout-content-markup").mousedown(function(t){n.element.canvas.inlineEditingIsActive&&t.stopPropagation()})}}});angular.module("LayoutEditor").directive("orcLayoutGrid",function(n,t,i){return{restrict:"E",scope:{element:"="},controller:function(n,i){t.configureForElement(n,i);t.configureForContainer(n,i);n.sortableOptions.axis="y"},templateUrl:i.baseUrl+"Templates/orc-layout-grid.html",replace:!0}});angular.module("LayoutEditor").directive("orcLayoutPopup",function(){return{restrict:"A",link:function(n,t,i){var r=$(t),u=r.closest(".layout-popup-trigger"),f=r.closest(".layout-element");u.click(function(){r.toggle();r.is(":visible")&&r.position({my:i.orcLayoutPopupMy||"left top",at:i.orcLayoutPopupAt||"left bottom+4px",of:u})});r.click(function(n){n.stopPropagation()});f.click(function(){r.hide()})}}});angular.module("LayoutEditor").directive("orcLayoutRow",function(n,t,i){return{restrict:"E",scope:{element:"="},controller:function(n,i){t.configureForElement(n,i);t.configureForContainer(n,i);n.sortableOptions.axis="x";n.sortableOptions["ui-floating"]=!0},templateUrl:i.baseUrl+"Templates/orc-layout-row.html",replace:!0}});
//# sourceMappingURL=LayoutEditor.min.js.map
