angular.module("LayoutEditor",["ngSanitize","ngResource","ui.sortable"]);angular.module("LayoutEditor").factory("scopeConfigurator",function(){return{configureForElement:function(n,t){t.find(".layout-panel").click(function(n){n.stopPropagation()});var i=t.find(".layout-element").first();i.hasClass("layout-element")||(i=t.parent());i.keydown(function(i){var u=!1,o=!1,r=n.element,f=r.getIsTemplated(),e;r.canvas.isDragging||r.canvas.inlineEditingIsActive||(f||(i.ctrlKey||i.shiftKey||i.altKey||i.which!=46?i.ctrlKey||i.shiftKey||i.altKey||i.which!=32||(t.find(".layout-panel-action-properties").first().click(),u=!0):(n.delete(r),u=!0),r.type=="Content"&&(i.ctrlKey||i.shiftKey||i.altKey||i.which!=13||(t.find(".layout-panel-action-edit").first().click(),u=!0))),!r.children||(i.ctrlKey||i.shiftKey||i.altKey||i.which!=45?i.ctrlKey||i.shiftKey||!i.altKey||i.which!=40||(r.children.length>0&&r.children[0].setIsFocused(),u=!0):(t.find(".layout-panel-add > .layout-panel-action").first().click(),u=!0),f||r.type=="Column"&&(e=!i.ctrlKey,i.which==37?(i.altKey&&r.expandLeft(e),i.shiftKey&&r.contractRight(e),u=!0):i.which==39&&(i.altKey&&r.contractLeft(e),i.shiftKey&&r.expandRight(e),u=!0))),!r.parent||(i.altKey&&i.which==38&&(r.parent.setIsFocused(),u=!0),r.parent.type=="Row"?i.ctrlKey||i.shiftKey||i.altKey||i.which!=37?i.ctrlKey||i.shiftKey||i.altKey||i.which!=39?f||!i.ctrlKey||i.shiftKey||i.altKey||i.which!=37?f||!i.ctrlKey||i.shiftKey||i.altKey||i.which!=39||(r.moveDown(),u=!0):(r.moveUp(),o=!0,u=!0):(r.parent.moveFocusNextChild(r),u=!0):(r.parent.moveFocusPrevChild(r),u=!0):i.ctrlKey||i.shiftKey||i.altKey||i.which!=38?i.ctrlKey||i.shiftKey||i.altKey||i.which!=40?f||!i.ctrlKey||i.shiftKey||i.altKey||i.which!=38?f||!i.ctrlKey||i.shiftKey||i.altKey||i.which!=40||(r.moveDown(),u=!0):(r.moveUp(),o=!0,u=!0):(r.parent.moveFocusNextChild(r),u=!0):(r.parent.moveFocusPrevChild(r),u=!0)),u&&i.preventDefault(),i.stopPropagation(),n.$apply(),o&&window.setTimeout(function(){n.$apply(function(){r.canvas.focusedElement.setIsFocused()})},100))});n.element.setIsFocusedEventHandlers.push(function(){var n=t.closest(".layout-element");n.length==0&&(n=t.find(".layout-element").first());n.focus()});n.click=function(n,t){n.canvas.isDragging||n.setIsFocused();t.stopPropagation()};n.delete=function(n){n.getIsTemplated()||window.confirm("Are you sure you want to delete this "+n.type+"?")&&n.delete()}},configureForContainer:function(n){var t=n.element,i=t.getIsTemplated();n.invokeAddContentElement=function(t){n.$root.addElement(t).then(function(t){n.$apply(function(){var r=n.element,i=LayoutEditor.Content.from({contentType:t.element.typeName,contentTypeLabel:t.element.typeLabel,contentTypeClass:t.element.typeClass,data:decodeURIComponent(t.element.data),html:decodeURIComponent(t.element.html.replace(/\+/g,"%20")),isTemplated:t.element.isTemplated});r.addChild(i);i.setIsFocused()})})};n.sortableOptions={cursor:"move",delay:150,distance:5,start:function(t,i){n.$apply(function(){n.element.canvas.isDragging=!0;n.element.isDropTarget=!0});i.placeholder.height(i.item.height())},stop:function(){n.$apply(function(){n.element.canvas.isDragging=!1;n.element.isDropTarget=!1})},disabled:i};n.getClasses=function(n){var t=["layout-element"];return!n.children||t.push("layout-container"),t.push("layout-"+n.type.toLowerCase()),n.type=="Row"&&t.push("row"),n.type=="Column"&&(t.push("col-xs-"+n.width),t.push("col-xs-offset-"+n.offset)),n.type=="Content"&&t.push("layout-content-"+n.contentTypeClass),n.getIsActive()&&t.push("layout-element-active"),n.getIsFocused()&&t.push("layout-element-focused"),n.getIsSelected()&&t.push("layout-element-selected"),n.isDropTarget&&t.push("layout-element-droptarget"),n.getIsTemplated()&&t.push("layout-element-templated"),t}}}});angular.module("LayoutEditor").directive("orcLayoutCanvas",function(n,scopeConfigurator,t){return{restrict:"E",scope:{},controller:function($scope,$element,$attrs){$scope.element=$attrs.model?eval($attrs.model):LayoutEditor.Canvas.from({isTemplate:!1,children:[]});scopeConfigurator.configureForElement($scope,$element);scopeConfigurator.configureForContainer($scope,$element);$scope.sortableOptions.axis="y";var layoutDesignerHost=$element.closest(".layout-designer").data("layout-designer-host");$scope.$root.layoutDesignerHost=layoutDesignerHost;layoutDesignerHost.element.on("replacemodel",function(n,t){var i=$scope.element;$scope.$apply(function(){i.setChildren(LayoutEditor.childrenFrom(t.canvas.children));i.setCanvas(i)})});$scope.$root.editElement=function(n,t){var i=$scope.$root.layoutDesignerHost;return i.editElement(n,t)};$scope.$root.addElement=function(n){var t=$scope.$root.layoutDesignerHost;return t.addElement(n)};$scope.toggleInlineEditing=function(){if($scope.element.inlineEditingIsActive)tinymce.remove("#layout-canvas-"+$scope.$id+" .layout-content-markup"),$element.find(".layout-toolbar-container").css("min-height",""),$scope.element.inlineEditingIsActive=!1;else{$scope.element.inlineEditingIsActive=!0;$element.find(".layout-toolbar-container").css("min-height","83px");var n="#layout-canvas-"+$scope.$id+" .layout-content-html .layout-content-markup[data-templated=false]",t=$(n).first().attr("id");tinymce.init({selector:n,theme:"modern",schema:"html5",plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking table contextmenu directionality","emoticons template paste textcolor colorpicker textpattern","fullscreen autoresize"],toolbar:"undo redo cut copy paste | bold italic | bullist numlist outdent indent formatselect | alignleft aligncenter alignright alignjustify ltr rtl | link unlink charmap | code fullscreen close",convert_urls:!1,valid_elements:"*[*]",extended_valid_elements:"script[type|defer|src|language]",statusbar:!1,skin:"orchardlightgray",inline:!0,fixed_toolbar_container:"#layout-canvas-"+$scope.$id+" > .layout-toolbar-container",init_instance_callback:function(n){n.id==t&&tinymce.execCommand("mceFocus",!1,n.id)}})}};$(document).on("cut copy paste",function(n){var t=$scope.element.canvas.focusedElement;!t||($scope.$apply(function(){switch(n.type){case"copy":t.copy(n.originalEvent.clipboardData);break;case"cut":t.cut(n.originalEvent.clipboardData);break;case"paste":t.paste(n.originalEvent.clipboardData)}}),n.preventDefault())})},templateUrl:t.baseUrl+"Templates/orc-layout-canvas.html",replace:!0,link:function(n,t){t.find(".layout-toolbar-container").click(function(n){n.stopPropagation()});t.mousedown(function(t){n.element.canvas.inlineEditingIsActive&&(t.preventDefault(),t.stopPropagation())});$(window).click(function(){n.element.canvas.inlineEditingIsActive||n.$apply(function(){n.element.canvas.activeElement=null;n.element.canvas.focusedElement=null})})}}});angular.module("LayoutEditor").directive("orcLayoutChild",function(n){return{restrict:"E",scope:{element:"="},link:function(t,i){var r="<orc-layout-"+t.element.type.toLowerCase()+" element='element' />",u=n(r)(t);$(i).replaceWith(u)}}});angular.module("LayoutEditor").directive("orcLayoutColumn",function(n,t,i){return{restrict:"E",scope:{element:"="},controller:function(n,i){t.configureForElement(n,i);t.configureForContainer(n,i);n.sortableOptions.axis="y"},templateUrl:i.baseUrl+"Templates/orc-layout-column.html",replace:!0,link:function(n,t){t.find(".layout-column-resize-bar").draggable({axis:"x",helper:"clone",revert:!0,start:function(){n.$apply(function(){n.element.canvas.isDragging=!0})},drag:function(i,r){var e=t.parent(),o=e.width()/n.element.width,u=!i.ctrlKey,f;$(i.target).hasClass("layout-column-resize-bar-left")?(f=r.offset.left-e.offset().left,f<-o&&n.element.canExpandLeft(u)?n.$apply(function(){n.element.expandLeft(u)}):f>o&&n.element.canContractLeft(u)&&n.$apply(function(){n.element.contractLeft(u)})):$(i.target).hasClass("layout-column-resize-bar-right")&&(f=r.offset.left-e.width()-e.offset().left,f>o&&n.element.canExpandRight(u)?n.$apply(function(){n.element.expandRight(u)}):f<-o&&n.element.canContractRight(u)&&n.$apply(function(){n.element.contractRight(u)}))},stop:function(){n.$apply(function(){n.element.canvas.isDragging=!1})}})}}});angular.module("LayoutEditor").directive("orcLayoutContent",function(n,t){return{restrict:"E",scope:{element:"="},controller:function(t,i){n.configureForElement(t,i);t.edit=function(){t.element.getIsTemplated()||t.$root.editElement(t.element.contentType,t.element.data).then(function(n){t.element.data=decodeURIComponent(n.element.data);t.element.html=decodeURIComponent(n.element.html.replace(/\+/g,"%20"));t.$apply()})};t.updateContent=function(n){t.element.html=n.target.innerHTML}},templateUrl:t.baseUrl+"Templates/orc-layout-content.html",replace:!0,link:function(n,t){t.find(".layout-content-markup").mousedown(function(t){n.element.canvas.inlineEditingIsActive&&t.stopPropagation()})}}});angular.module("LayoutEditor").directive("orcLayoutGrid",function(n,t,i){return{restrict:"E",scope:{element:"="},controller:function(n,i){t.configureForElement(n,i);t.configureForContainer(n,i);n.sortableOptions.axis="y"},templateUrl:i.baseUrl+"Templates/orc-layout-grid.html",replace:!0}});angular.module("LayoutEditor").directive("orcLayoutPopup",function(){return{restrict:"A",link:function(n,t,i){var r=$(t),u=r.closest(".layout-popup-trigger"),f=r.closest(".layout-element");u.click(function(){r.toggle();r.is(":visible")&&r.position({my:i.orcLayoutPopupMy||"left top",at:i.orcLayoutPopupAt||"left bottom+4px",of:u})});r.click(function(n){n.stopPropagation()});f.click(function(){r.hide()})}}});angular.module("LayoutEditor").directive("orcLayoutRow",function(n,t,i){return{restrict:"E",scope:{element:"="},controller:function(n,i){t.configureForElement(n,i);t.configureForContainer(n,i);n.sortableOptions.axis="x";n.sortableOptions["ui-floating"]=!0},templateUrl:i.baseUrl+"Templates/orc-layout-row.html",replace:!0}});
//# sourceMappingURL=LayoutEditor.min.js.map
